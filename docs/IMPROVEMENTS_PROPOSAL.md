# Предложения по улучшению MockController для нагрузочного тестирования

## 1. Управление HTTP статус-кодами ответов (КРИТИЧНО)

### Проблема
Сейчас нет возможности управлять HTTP кодами ответов (500, 503, 404 и т.д.), что критично для тестирования отказов.

### Решение
Добавить новый тип параметра `errorCodes` в конфиг:

```json
{
  "config": {
    "errorCodes": {
      "/api/login": {
        "statusCode": 500,
        "probability": 30,  // 30% вероятность ошибки
        "message": "Internal Server Error"
      },
      "/api/users": {
        "statusCode": 503,
        "probability": 50,
        "message": "Service Unavailable"
      }
    }
  }
}
```

**Или более гибкий вариант с паттернами:**

```json
{
  "config": {
    "responsePatterns": {
      "/api/login": {
        "patterns": [
          {
            "statusCode": 200,
            "probability": 70,
            "delay": 100
          },
          {
            "statusCode": 500,
            "probability": 20,
            "delay": 0,
            "message": "Internal Server Error"
          },
          {
            "statusCode": 503,
            "probability": 10,
            "delay": 5000,
            "message": "Service Unavailable"
          }
        ]
      }
    }
  }
}
```

### UI
- Добавить секцию "HTTP статус-коды" в страницу редактирования конфига
- Выбор кода (200, 400, 401, 404, 500, 502, 503, 504)
- Настройка вероятности (0-100%)
- Настройка сообщения об ошибке
- По endpoint или глобально

---

## 2. Последовательные паттерны ошибок (ВАЖНО)

### Проблема
Иногда нужно задать паттерн: первые N запросов - ошибка, потом успех.

### Решение
Добавить `sequentialPatterns`:

```json
{
  "config": {
    "sequentialPatterns": {
      "/api/orders": {
        "steps": [
          {
            "count": 10,  // первые 10 запросов
            "statusCode": 500,
            "message": "Service unavailable"
          },
          {
            "count": -1,  // все остальные
            "statusCode": 200,
            "delay": 100
          }
        ]
      }
    }
  }
}
```

### UI
- Визуальный редактор последовательностей
- Счетчик запросов
- Автосброс после определенного количества

---

## 3. Частичные отказы сервиса (ВАЖНО)

### Проблема
Нужно симулировать ситуации, когда сервис работает медленно, но не падает.

### Решение
Добавить `degradationMode`:

```json
{
  "config": {
    "degradationMode": {
      "enabled": true,
      "maxResponseTime": 10000,  // 10 секунд максимум
      "failureRate": 30,  // 30% запросов не отвечают
      "slowdownFactor": 5  // все запросы в 5 раз медленнее
    }
  }
}
```

---

## 4. Статистика и мониторинг (СРЕДНИЙ ПРИОРИТЕТ)

### Что добавить:
- **Счетчики запросов** по каждому endpoint
- **Счетчики ошибок** по статус-кодам
- **Графики** изменения задержек/ошибок во времени
- **История изменений** конфигураций с возможностью отката
- **Экспорт статистики** в CSV/JSON

### UI
- Дашборд с метриками
- Графики в реальном времени
- Фильтры по времени/системе

---

## 5. Условная логика ответов (СРЕДНИЙ ПРИОРИТЕТ)

### Проблема
Нужны разные ответы в зависимости от параметров запроса.

### Решение
```json
{
  "config": {
    "conditionalResponses": {
      "/api/users": [
        {
          "condition": {
            "param": "userId",
            "equals": "admin"
          },
          "statusCode": 200,
          "delay": 100
        },
        {
          "condition": {
            "param": "userId",
            "startsWith": "test-"
          },
          "statusCode": 403,
          "message": "Test user denied"
        },
        {
          "default": true
        },
        "statusCode": 200,
        "delay": 500
      ]
    }
  }
}
```

---

## 6. Массовые операции (НИЗКИЙ ПРИОРИТЕТ)

### Что добавить:
- **Массовое изменение** задержек/ошибок для группы заглушек
- **Шаблоны поведения** (например, "деградация 50%", "полный отказ")
- **Быстрые пресеты** ("Быстрый режим", "Режим отказов", "Режим деградации")

### UI
- Кнопки быстрых действий на странице группы
- Выпадающий список пресетов

---

## 7. Интеграция с инструментами тестирования (НИЗКИЙ ПРИОРИТЕТ)

### Что добавить:
- **Webhooks** для уведомлений об изменениях конфигураций
- **API для автоматизации** тестовых сценариев
- **Интеграция с Grafana** для визуализации метрик

---

## Приоритизация

### Фаза 1 (КРИТИЧНО - реализовать в первую очередь):
1. ✅ Управление HTTP статус-кодами (errorCodes)
2. ✅ Базовый процентный паттерн ошибок

### Фаза 2 (ВАЖНО):
3. ✅ Последовательные паттерны
4. ✅ Частичные отказы

### Фаза 3 (УЛУЧШЕНИЕ):
5. ✅ Базовая статистика
6. ✅ История изменений

### Фаза 4 (БУДУЩЕЕ):
7. ✅ Условная логика
8. ✅ Массовые операции
9. ✅ Интеграции

---

## Пример использования после реализации

### Сценарий: Тестирование устойчивости к отказу внешнего сервиса

1. Создаем сценарий:
   - 00:00 - Включаем 50% ошибок 500 на auth-service
   - 00:05 - Увеличиваем задержку до 10 секунд
   - 00:10 - Отключаем ошибки, возвращаем нормальную задержку

2. Запускаем нагрузочный тест параллельно

3. Наблюдаем:
   - Как система обрабатывает ошибки
   - Как работает retry механизм
   - Как система восстанавливается после сбоя

Это позволит полноценно тестировать отказоустойчивость системы!


