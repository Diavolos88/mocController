# Vision & Context

## 1. Контекст
- Я работаю нагрузочным тестировщиком и у нас в проекте есть множество заглушек, эмулирующих разные системы, в связи с чем я хочу сделать один сервис через который будет возможность изменять времена ответа, переключать уровень логитрования и задавать значения для разных переменных.
- Этот сервис будет развернут в openshift вместе с остальными заглушками, заглушки будут периодически стучаться и проверять изменились ли конфиги, если изменились, то вызывать ручку и скачивать обновленный конфиг
- Сервис должен будет хранить конфиги в базе данных (но изначально будем хранить локально)
- Изначально будет поддержка отложенных изменений (задали время, и сервис применил правки позже без участия человека)

## 2. Проблема
- Основная проблема в том, что все конфиги и времена ответов нужно менять отдельно у каждой заглушки и после этого рестортавать их
- цель сделать так, чтобы можно было не рестартовать заглушки и менять все значения в онлайне

## 3. Предлагаемое решение
- MockKontroller предоставляет REST-эндпоинты для сохранения и выдачи конфигов, а также веб-UI, где тестировщик может мгновенно менять задержки, параметры и уровни логирования.
- Заглушки будут периодически опрашивать служебный эндпоинт «конфиг обновлён?» и при необходимости скачивать свежую версию через отдельную ручку.
- Для каждого параметра UI показывает текущее значение, «стартовое» значение (то, что заглушка прислала при первом запуске) и кнопку возврата к стартовому состоянию. Также доступна кнопка, которая откатывает весь конфиг к исходному состоянию.
- Отложенные изменения поддерживаются из коробки: можно указать точное время (МСК), когда новое значение вступит в силу. Сервис сам применяет его и хранит очередь будущих изменений.
- Стартовые конфиги всегда сохраняются отдельно. Если заглушка запускается впервые или присылает конфиг, которого нет в базе, сервис принимает его как стартовый и сообщает, что обновление не требуется.
- Если присланный конфиг совпадает со стартовым, но в хранилище уже есть более свежая рабочая версия, сервис отвечает «нужно обновиться» и отправляет заглушку на эндпоинт загрузки новой версии.

## 4. Сценарий использования
- Тестировщик хочет проверить длинные задержки: заходит в UI сервиса, увеличивает `responseDelay` выбранных заглушек на +10 секунд и сохраняет изменения. Заглушки получают новые значения без рестарта и начинают отвечать медленнее.
- После завершения теста тестировщик планирует автоматический возврат параметров: создаёт отложенную задачу, которая через заданное время вернёт все значения к стартовым. Сервис хранит таску, применяет изменения в указанное время и сообщает в UI, что конфиг снова в исходном состоянии.

## 5. Структура конфига
```
{
  "SystemName": "auth-mock",
  "config": {
    "Config version": "v1.0",
    "delays": { "key1": "value1", ... },
    "stringParams": { "key1": "value1", ... },
    "loggingLv": "ERROR"
  }
}
```
В дальнейшем схема конфига может расширяться (дополнительные типы параметров, поля расписаний и пр.).